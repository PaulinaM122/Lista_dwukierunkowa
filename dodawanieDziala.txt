#include <iostream>
//#include <cstdlib>
#include <stdlib.h>

using namespace std;

class Node {
    unsigned long long int data;
    public:
        Node* next;
        Node* prev;
        void setData(unsigned long long int data) { this->data = data; }
        unsigned long long int getData() { return this->data; }
};

void insertAfter(Node* prevNode, Node** beg, Node** end,  unsigned long long int newData) {
    Node* newNode = new Node();
    newNode->setData(newData);
    newNode->next = NULL;
    if (prevNode == NULL || prevNode == *beg) {
        newNode->prev = NULL;
        *beg = newNode;
        *end = newNode;
        return;
    }

    newNode->prev = prevNode;
    if (prevNode->next != NULL) {
        newNode->next = prevNode->next;
        newNode->next->prev = newNode;
    }
    else (*end) = newNode;
    prevNode->next = newNode;
}

void insertBefore(Node* node, Node** head, unsigned long long int newData) {
    if (node == NULL) return;
    Node* newNode = new Node();
    newNode->next = node;
    newNode->setData(newData);
    newNode->prev = node->prev;
    node->prev = newNode;
    if (newNode->prev == NULL) return;
    newNode->prev->next = newNode;
}

void removeNode(Node** beg, Node **end, Node* node) {
                            //cout << " REMOVE iterator[0] " << node << " *beg: " << *beg << endl;
    if (node == NULL || *beg == NULL) return;
    if ((*beg) == node)
        (*beg) = node->next;
    else if (node == (*end)) (*end) = node->prev;
    if (node->next != NULL)
        node->next->prev = node->prev;
    if (node->prev != NULL)
        node->prev->next = node->next;
    delete node;
}

void addFirst(Node** head, Node** end, int newData) {
    Node* newNode = new Node();

    newNode->setData(newData);
    newNode->next = (*head);
    newNode->prev = NULL;

    if ((*head) != NULL)
        (*head)->prev = newNode;
    else (*end) = newNode; 

    (*head) = newNode;
}

void addLast(Node** beg, Node** end, int newData) {
    Node* newNode = new Node();
    newNode->setData(newData);
    newNode->next = NULL;

    if ((*beg) == NULL) {
        newNode->prev = NULL;
        *beg = newNode;
        *end = newNode;
    }

    while ((*end)->next != NULL)
        (*end) = (*end)->next;

    (*end)->next = newNode;
    newNode->prev = (*end);
    (*end) = newNode;
    (*end)->next = NULL;
}

void printList(Node* beg, Node* end) {
    if (beg == NULL);
    else if (beg == end) cout << " " << beg->getData() << endl;
    else {
        while (beg != end) {
            cout << " " << beg->getData() << " ";
            beg = beg->next;
        }
        cout << end->getData() << endl;
    }
}

void insertB(char x, Node* iterator[], Node** beg, Node** end) {
    long long unsigned int y;
    char c;
    if (x == 'B' || x == 'E') {
        cin >> c >> c >> y;
        if (x == 'B') addFirst(beg, end, y);
        else insertBefore(*end, beg, y);
    }
    else {
        int number = atoi(&x);
        cin >> y;
        insertBefore(iterator[number], beg, y);
    }
}

void insertA(char x, Node** iterator, Node** beg, Node** end) {
    unsigned long long int y;
    char c;
    if (x == 'B' || x == 'E') {
        cin >> c >> c >> y;
        if (x == 'B') insertAfter(*beg, beg, end,  y);
        else addLast(beg, end, y);
    }
    else {
        int number = atoi(&x);
        cin >> y;
        insertAfter(iterator[number], beg, end, y);
    }
}

void printing(char p, Node* iterator, Node* beg, Node* end) {
    if (p == 'A') {
        cin >> p >> p;
        printList(beg, end);
    }
    else {
        int number = atoi(&p);
        cout << iterator[number].getData() << endl;
    }
}

void removing(Node** iterator, Node** beg, Node** end) {
    Node* tmp = *iterator;
    if (tmp->next != NULL) *iterator = tmp->next;
    else if (tmp->prev != NULL) *iterator = tmp->prev;
    else iterator = nullptr;
    removeNode(beg, end, tmp);
}

void inicialization(long long unsigned int y, Node* iterator[], Node** beg) {
    long long unsigned int ile = 0;
    Node* node = *beg;
    while (ile < y) {
        if (node == NULL) {
            cout << "BLAD " << endl;
            break;
        }
        node = node->next;
        ile++;
    }
    iterator[y] = node;
                        //cout << "iterator[y] = " << iterator[y] << endl;
}

void initIterator(int x, Node** iterator, Node** beg, Node** end) {
    unsigned long long int y;
    char x2, sth;

    cin >> x2;
    if (x2 == 'B' || x2 == 'E') {
        cin >> sth >> sth;
        if (x2 == 'B') *iterator = *beg;
        else *iterator = *end;
    }
    else {
        long long unsigned int ile = 0;
        Node* node = *beg;
        while (ile < x) {
            if (node == NULL) {
                cout << "BLAD " << endl;
                break;
            }
            node = node->next;
            ile++;
        }
        *iterator = node;
    }
}

void moveForward(int x, Node** iterator) {
    if (iterator[x] == NULL);
    else if (iterator[x]->next == NULL);
    else iterator[x] = iterator[x]->next;
}

void moveBack(int x, Node** iterator) {
    if (iterator[x] == NULL);
    else if (iterator[x]->prev == NULL);
    else iterator[x] = iterator[x]->prev;
}

int main()
{
    Node* beg = NULL;
    Node* end = NULL;
    Node** iterator = new Node*[10];
    for (int i = 0; i < 10; i++) {
        iterator[i] = nullptr;
    }
    char c, x, p;
    int q;

    while (cin) {
        cin >> c;
        switch (c) {
        case '.':
            cin >> c >> x;
            insertB(x, iterator, &beg, &end);
            break;
        case 'A':
            cin >> c >> x;
            insertA(x, iterator, &beg, &end);
            break;
        case 'i':
            cin >> q;
            initIterator(q, &iterator[q], &beg, &end);
            break;
        case 'I':
            cin >> q;
            break;
        case '+':
            cin >> q;
            moveForward(q, iterator);
            break;
        case '-':
            cin >> q;
            moveBack(q, iterator);
            break;
        case 'R':
            cin >> x;
            if ((x == 'E') || (x == 'B')) {
                cin >> c >> c;
                if (x == 'B') removeNode(&beg, &end, beg);
                else removeNode(&beg, &end, end);
            }
            else {
                int n = atoi(&x);
                for (int i = 0; i < 10; i++) {
                    if (i == n) continue;
                    if (iterator[i] == iterator[n]) {
                        Node** tmp = &iterator[i];
                        if ((*tmp)->next != NULL) iterator[i] = (*tmp)->next;
                        else if ((*tmp)->prev != NULL) iterator[i] = (*tmp)->prev;
                        else iterator[i] = nullptr;
                    }
                        
                }
                removing(&iterator[n], &beg, &end);
                /*Node** tmp = &iterator[n];
                if (tmp->next != NULL) iterator[n] = tmp->next;
                else if (tmp->prev != NULL) iterator[n] = tmp->prev;
                else iterator[n] = nullptr;*/
            }
            break;
        case 'P':
            cin >> p;
            if (p == 'A') {
                printing(p, *iterator, beg, end);
            }
            else {
                int n = atoi(&p);
                if (iterator[n] == nullptr);
                else cout << iterator[n]->getData() << endl;
            }
            break;
        }
        c = NULL;
    }

    return 0;
}